<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>MoneySend - PWA</title>
  <link rel="manifest" href="/static/manifest.json">
  <link rel="icon" href="/static/icon-192.png">
  <meta name="theme-color" content="#1e88e5">
</head>
<body>
  <h2>Connexion</h2>
  <input id="username" placeholder="Nom d'utilisateur">
  <input id="password" type="password" placeholder="Mot de passe">
  <button onclick="login()">Connexion</button>

  <h2>Envoyer de l'argent</h2>
  <input id="recipient" placeholder="Destinataire">
  <input id="amount" type="number" placeholder="Montant">
  <select id="method">
    <option value="cash">Cash</option>
    <option value="bank">Banque</option>
  </select>
  <button onclick="sendMoney()">Envoyer</button>

  <script>
    let token = "";

    async function login() {
      const res = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username: document.getElementById("username").value,
          password: document.getElementById("password").value
        })
      });
      const data = await res.json();
      token = data.token;
      alert("Connecté !");
    }

    async function sendMoney() {
      const res = await fetch("/send-money", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
          recipient: document.getElementById("recipient").value,
          amount: parseFloat(document.getElementById("amount").value),
          method: document.getElementById("method").value
        })
      });
      const data = await res.json();
      alert(data.message);
    }

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/static/service-worker.js")
        .then(() => console.log("✅ Service Worker enregistré"));
    }
  </script>
</body>
</html>
